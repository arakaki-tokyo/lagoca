(()=>{var e={98:e=>{var t,s,n,a,i;e.exports=(s=t=class{static onChange(e,t){this._data.has(e)||this._data.set(e,{value:null,SOs:[]}),this._data.get(e).SOs.push(t)}static set(e,t){if(this._data.has(e)){const s=this._data.get(e);s.value=t,s.SOs.forEach((s=>s.update({key:e,value:t})))}else this._data.set(e,{value:t,SOs:[]})}},n=t,a="_data",i=new Map,a in n?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i,s)},181:(e,t,s)=>{const n=s(98),a=s(135),i={App:{name:"App",option:{keyPath:"key"}},DoneAct:{name:"DoneAct",option:{keyPath:"start"}},Routine:{name:"Routine",option:{keyPath:"id"},index:[{name:"order",keyPath:"order"}]},Diary:{name:"Diary",option:{keyPath:"date"},index:[{name:"isSynced",keyPath:"isSynced"}]},TaskList:{name:"TaskList",option:{keyPath:"id"},index:[{name:"order",keyPath:"order"}]},Task:{name:"Task",option:{keyPath:"id"},index:[{name:"listId",keyPath:["listId","position"]},{name:"parent",keyPath:"parent"}]}};e.exports=new class{constructor(e){var t,s,n;n=2,(s="VERSION")in(t=this)?Object.defineProperty(t,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[s]=n;const a=indexedDB.open("logoca",this.VERSION);a.onupgradeneeded=function(t){const s=t.target.result;Object.values(e).forEach((e=>{if(s.objectStoreNames.contains(e.name))return;const t=e.option?s.createObjectStore(e.name,e.option):s.createObjectStore(e.name);e.index&&e.index.forEach((e=>t.createIndex(e.name,e.keyPath)))}))},this.db=new Promise((e=>{a.onsuccess=t=>e(t.target.result)})),Object.values(e).forEach((e=>{this[`get${e.name}`]=t=>this._get(e.name,t),this[`getAll${e.name}`]=t=>this._getAll(e.name,t),this[`getIndexAll${e.name}`]=(t,s)=>this._getIndexAll(e.name,t,s),this[`getAllKV${e.name}`]=t=>this._getAllKV(e.name,t),this[`set${e.name}`]=t=>this._set(e.name,t),this[`update${e.name}`]=(t,s)=>this._update(e.name,t,s),this[`delete${e.name}`]=t=>this._delete(e.name,t)}))}init(){this.getAllApp().then((e=>e.forEach((({key:e,value:t})=>{n.set(e,t),this[e]=t})))).then((()=>{n.onChange(a.doingAct,this),n.onChange(a.settings,this),n.onChange(a.doneActList,this)}))}update({key:e,value:t}){this.setApp({key:e,value:t}),this[e]=t}save(e){this.setApp({key:e,value:this[e]})}_get(e,t){return this.db.then((s=>{const n=s.transaction(e,"readonly").objectStore(e).get(t);return new Promise(((e,t)=>{n.onsuccess=t=>e(t.target.result),n.onerrors=e=>t(e)}))}))}_getAll(e,t){return this.db.then((s=>{const n=s.transaction(e,"readonly").objectStore(e),a=void 0!==t?n.getAll(t):n.getAll();return new Promise(((e,t)=>{a.onsuccess=t=>e(t.target.result),a.onerrors=e=>t(e)}))}))}_getIndexAll(e,t,s){return this.db.then((n=>{const a=n.transaction(e,"readonly").objectStore(e).index(t),i=void 0!==s?a.getAll(s):a.getAll();return new Promise(((e,t)=>{i.onsuccess=t=>e(t.target.result),i.onerrors=e=>t(e)}))}))}_getAllKV(e,t){return this.db.then((s=>{const n=s.transaction(e,"readonly").objectStore(e),a=void 0!==t?n.openCursor(t):n.openCursor();return new Promise(((e,t)=>{const s=[];a.onsuccess=t=>{let n=t.target.result;n?(s.push({key:n.key,value:n.value}),n.continue()):e(s)},a.onerrors=e=>t(e)}))}))}_set(e,t){return this.db.then((s=>{const n=s.transaction(e,"readwrite").objectStore(e).put(t);return new Promise(((e,t)=>{n.onsuccess=t=>e(t.target.result),n.onerrors=e=>t(e)}))}))}_update(e,t,s){return this.db.then((n=>{const a=n.transaction(e,"readwrite").objectStore(e).openCursor(t);return new Promise(((t,n)=>{a.onsuccess=n=>{const a=n.target.result;a?a.update(s(a.value)).onsuccess=()=>t(void 0):this[`set${e}`](s()).then((()=>t(void 0)))},a.onerrors=e=>n(e)}))}))}_delete(e,t){return this.db.then((s=>{const n=s.transaction(e,"readwrite").objectStore(e).delete(t);return new Promise(((e,t)=>{n.onsuccess=t=>e(t.target.result),n.onerrors=e=>t(e)}))}))}syncDiary(e){return this.db.then((t=>{const s=t.transaction(i.Diary.name,"readwrite").objectStore(i.Diary.name).openCursor(e.date);return new Promise(((t,n)=>{s.onsuccess=s=>{const n=s.target.result;if(!n)return this.setDiary(e);n.value.timestamp>=e.timestamp||(n.update(e).onsuccess=()=>t(void 0))},s.onerrors=e=>n(e)}))}))}}(i)},135:e=>{e.exports={userProfile:"usrProfile",calendars:"calendars",settings:"settings",tmpNewCalendar:"tmpNewCalendar",isAddCalInProgress:"isAddCalInProgress",addedCalendar:"addedCalendar",summaryFromView:"summaryFromView",summaryToView:"summaryToView",descriptionFromView:"descriptionFromView",descriptionToView:"descriptionToView",doingAct:"doingAct",isSignedIn:"isSignedIn",notice:"notice",doneActList:"doneActList",sw:"sw",toBeStartedAct:"toBeStartedAct",listInserted:"listInserted",anotherAct:"anotherAct"}}},t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(()=>{const e=s(181),t=(new class{constructor(){self.addEventListener("message",this.recieve.bind(this))}recieve(e){e.data?this.showActNotice(e.data):registration.getNotifications().then((e=>e.forEach((e=>e.close()))))}async showActNotice(e){const s=await t.getImg("/favicon.ico"),n=await t.getImg("/img/logo72.png"),a=new Date(e.start),i=String(a.getHours()).padStart(2,"0"),r=String(a.getMinutes()).padStart(2,"0");self.registration.showNotification(`${e.summary} (${i}:${r} ~)`,{badge:s,icon:n,renotify:!1,silent:!0,tag:"logoca",data:e.start,actions:[{action:"end",title:"end action"}]})}},new class{constructor(){addEventListener("notificationclick",this.click.bind(this))}click(e){e.notification.close();const t="end"===e.action?this.endAct.bind(this):this.showPage;e.waitUntil(self.clients.matchAll({type:"window"}).then((e=>e.find((e=>e.url==`${location.origin}/`)))).then((s=>t(s,e))))}showPage(e){return e?e.focus():self.clients.openWindow?self.clients.openWindow(`${location.origin}/`):void 0}async endAct(t,s){if(!t){let t;await e.updateApp("doingAct",(({key:e,value:s})=>(t={...s},{key:e,value:null}))),t.isSynced=!1,t.end=Date.now();const[s,n,a]=this.calcElapsedTime(t.start,t.end),i=`${0==s?"":s+"h"}${n}m`;return await e.updateApp("summaryToView",(({key:e,value:s})=>(t.summary=`${s} (${i})`,{key:e,value:""}))),await e.updateApp("descriptionToView",(({key:e,value:s})=>(t.description=s,{key:e,value:""}))),await e.updateApp("doneActList",(({key:e,value:s})=>(s.push(t),{key:e,value:s})))}t.postMessage(null)}calcElapsedTime(e,t){const s=Math.floor((t-e)/1e3);return[Math.floor(s/3600),Math.floor(s/60)%60,s%60]}},new class{constructor(){var e,t,s;s=[{version:"13",urls:["/index.js"]},{version:"10",urls:["/","/style.css"]},{version:"1",urls:["/favicon.ico","/img/logo.svg","/img/favicon.svg","/img/logo72.png","/img/logo192.png"]}],(t="cacheItems")in(e=this)?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,self.addEventListener("install",this.addCache.bind(this)),self.addEventListener("activate",this.removeCache.bind(this)),self.addEventListener("fetch",this.proxy)}addCache(e){e.waitUntil(Promise.all(this.cacheItems.map((e=>caches.open(e.version).then((t=>Promise.all(e.urls.map((async e=>await t.match(e)?Promise.resolve():t.add(e))))))))))}removeCache(e){e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{const t=this.cacheItems.find((t=>t.version===e));return t?caches.open(e).then((async e=>{const s=await e.keys();await Promise.all(s.map((s=>t.urls.find((e=>e===new URL(s.url).pathname))?Promise.resolve():e.delete(s))))})):caches.delete(e)}))))))}proxy(e){e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))}getImg(e){return new Promise((async t=>{const s=await caches.match(e),n=await s.blob();let a=new FileReader;a.readAsDataURL(n),a.onload=e=>t(e.target.result)}))}})})()})();